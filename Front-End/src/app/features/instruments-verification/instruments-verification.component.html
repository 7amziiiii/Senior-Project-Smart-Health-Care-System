<div class="feature-container">
  <div class="feature-header">
    <div class="title-area">
      <div class="page-title">
        <span class="feature-icon"><i class="fas fa-clipboard-check"></i></span>
        <h1>Instruments Verification</h1>
      </div>
      <p class="breadcrumb">
        <a [routerLink]="['/dashboard']" class="back-link"><i class="fas fa-angle-left"></i> Back to Dashboard</a>
      </p>
    </div>
    <div class="button-group">
      <button class="btn btn-secondary" routerLink="/dashboard">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </button>
    </div>
  </div>
  
  <div class="feature-content">
    <div class="container">
      <div class="header-section">
        <h2>Instruments Verification</h2>
        <span class="breadcrumb">
          <a [routerLink]="['/dashboard']" class="back-link"><i class="fas fa-angle-left"></i> Back to Dashboard</a>
        </span>
      </div>

      <div *ngIf="!selectedSurgery" class="surgery-selection">
        <h3>Select a Surgery</h3>
        <div class="surgery-list">
          <div *ngFor="let surgery of surgeries" 
              class="surgery-card" 
              [class.ongoing]="surgery.status === 'ongoing'" 
              [class.scheduled]="surgery.status === 'scheduled'"
              (click)="selectSurgery(surgery)">
            <h4>{{ surgery.name }}</h4>
            <p>{{ surgery.scheduledTime | date:'medium' }}</p>
            <p>Status: <span [ngClass]="{'ongoing-status': surgery.status === 'ongoing', 'scheduled-status': surgery.status === 'scheduled'}">{{ surgery.status }}</span></p>
          </div>
        </div>
      </div>

      <div *ngIf="selectedSurgery" class="verification-container">
        <div class="surgery-info">
          <h3>{{ selectedSurgery.name }}</h3>
          <p>{{ selectedSurgery.scheduledTime | date:'medium' }}</p>
          <p>Status: <span [ngClass]="{'ongoing-status': selectedSurgery.status === 'ongoing', 'scheduled-status': selectedSurgery.status === 'scheduled'}">{{ selectedSurgery.status }}</span></p>
          <button (click)="selectSurgery(null)" class="back-btn"><i class="fas fa-angle-left"></i> Back to Surgery List</button>
          
          <!-- Verification Controls -->
          <div class="verification-controls">
            <button (click)="forceVerificationScan()" class="scan-btn">
              <i class="fas fa-sync"></i> Force Scan
            </button>
            <div class="verification-status" *ngIf="verificationStatus">
              <span class="status-label">Last Updated:</span>
              <span class="status-value">{{ verificationStatus.last_updated | date:'medium' }}</span>
            </div>
          </div>
        </div>

        <!-- Loading indicator -->
        <div *ngIf="isVerifying && !verificationStatus" class="loading-indicator">
          <p><i class="fas fa-spinner fa-spin"></i> Starting verification...</p>
        </div>

        <!-- Real-time verification data -->
        <div *ngIf="verificationStatus" class="summary-stats">
          <div class="stat-box">
            <h4>Verification Status</h4>
            <p [ngClass]="{
              'status-complete': verificationStatus.state === 'complete',
              'status-incomplete': verificationStatus.state === 'incomplete',
              'status-failed': verificationStatus.state === 'failed'
            }">{{ verificationStatus.state | titlecase }}</p>
          </div>
          <div class="stat-box">
            <h4>Instruments Used</h4>
            <p>{{ getItemsCount('used', 'instruments') }}</p>
          </div>
          <div class="stat-box">
            <h4>Missing</h4>
            <p>{{ getItemsCount('missing', 'instruments') }}</p>
          </div>
          <div class="stat-box">
            <h4>Extra</h4>
            <p>{{ getItemsCount('extra', 'instruments') }}</p>
          </div>
          <div class="stat-box">
            <h4>Available</h4>
            <p>{{ getItemsCount('available', 'instruments') }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
